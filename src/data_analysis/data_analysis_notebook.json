{"paragraphs":[{"text":"%spark.dep\nz.load(\"org.postgresql:postgresql:42.2.5\")","user":"anonymous","dateUpdated":"2019-10-11T00:25:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@2c2a87af\n"}]},"apps":[],"jobName":"paragraph_1570751644349_-385417568","id":"20191010-235404_2115226141","dateCreated":"2019-10-10T23:54:04+0000","dateStarted":"2019-10-11T00:25:27+0000","dateFinished":"2019-10-11T00:25:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:69729"},{"text":"//IMPORT EVERYTHING NEEDED\nimport org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.functions.typedLit\nimport java.util.Properties\nimport org.apache.hadoop.conf.Configuration\nimport org.apache.spark.SparkContext\nimport org.apache.spark.SparkConf\nimport org.apache.spark.sql.types.{IntegerType, StringType, StructField, StructType}\nimport org.apache.spark.sql.{Row, SQLContext}\nimport org.apache.spark.{SparkConf, SparkContext}","user":"anonymous","dateUpdated":"2019-10-11T00:25:41+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.functions.typedLit\nimport java.util.Properties\nimport org.apache.hadoop.conf.Configuration\nimport org.apache.spark.SparkContext\nimport org.apache.spark.SparkConf\nimport org.apache.spark.sql.types.{IntegerType, StringType, StructField, StructType}\nimport org.apache.spark.sql.{Row, SQLContext}\nimport org.apache.spark.{SparkConf, SparkContext}\n"}]},"apps":[],"jobName":"paragraph_1570750712046_-104078856","id":"20191010-233832_1609111368","dateCreated":"2019-10-10T23:38:32+0000","dateStarted":"2019-10-11T00:25:41+0000","dateFinished":"2019-10-11T00:26:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69730"},{"text":"// START SPARK SESSION\nval spark = SparkSession.builder.appName(\"Spark Posts\").config(\"spark.master\", \"local\").getOrCreate()\nimport spark.implicits._\n","user":"anonymous","dateUpdated":"2019-10-11T00:26:05+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@103e08e3\nimport spark.implicits._\n"}]},"apps":[],"jobName":"paragraph_1570750747366_1689308633","id":"20191010-233907_702806586","dateCreated":"2019-10-10T23:39:07+0000","dateStarted":"2019-10-11T00:26:06+0000","dateFinished":"2019-10-11T00:26:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69731"},{"text":"// SET UP DATABASE CONNECTION\r\nval jdbcUrl = \"jdbc:postgresql://35.239.57.52/shared-world-database\"\r\nval connectionProperties = new Properties()\r\nconnectionProperties.put(\"user\", \"postgres\")\r\nconnectionProperties.put(\"password\", \"contiki123\")\r\nconnectionProperties.setProperty(\"Driver\", \"org.postgresql.Driver\")","user":"anonymous","dateUpdated":"2019-10-11T00:26:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"jdbcUrl: String = jdbc:postgresql://35.239.57.52/shared-world-database\nconnectionProperties: java.util.Properties = {}\nres9: Object = null\nres10: Object = null\nres11: Object = null\n"}]},"apps":[],"jobName":"paragraph_1570750849502_1848476239","id":"20191010-234049_1198549647","dateCreated":"2019-10-10T23:40:49+0000","dateStarted":"2019-10-11T00:26:11+0000","dateFinished":"2019-10-11T00:26:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69732"},{"title":"MOST POSTS (BY COUNTRY)","text":"// Df of all posts grouped and ordered in desc for each country\nval all_posts = spark.read.jdbc(jdbcUrl, \"post_post\", connectionProperties).groupBy(\"country_id\").count().sort($\"count\".desc)\nz.show(all_posts)","user":"anonymous","dateUpdated":"2019-10-11T00:26:16+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"1":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country_id":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"all_posts: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [country_id: string, count: bigint]\n"},{"type":"TABLE","data":"country_id\tcount\nUS\t10\nAU\t10\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-d290-m.us-central1-a.c.shared-world.internal:4040/jobs/job?id=0"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1570750882192_333244963","id":"20191010-234122_495090360","dateCreated":"2019-10-10T23:41:22+0000","dateStarted":"2019-10-11T00:26:17+0000","dateFinished":"2019-10-11T00:26:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69733"},{"text":"//Create df of tags for all posts\nval tagged_posts = spark.read.jdbc(jdbcUrl, \"taggit_taggeditem\", connectionProperties).filter($\"content_type_id\" === 9).select($\"object_id\", $\"tag_id\").toDF(\"post_id\", \"tag_id\")\n\n// Create df of tag names\nval tags = spark.read.jdbc(jdbcUrl, \"taggit_tag\", connectionProperties).select($\"id\",$\"name\").toDF(\"tag_id\", \"tag_name\").join(tagged_posts, \"tag_id\").groupBy(\"tag_name\").count().sort($\"count\".desc)\n\nz.show(tags)","user":"anonymous","dateUpdated":"2019-10-11T00:31:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"1":{"graph":{"mode":"lineChart","height":300,"optionOpen":false,"setting":{"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"tag_name","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tagged_posts: org.apache.spark.sql.DataFrame = [post_id: int, tag_id: int]\ntags: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [tag_name: string, count: bigint]\n"},{"type":"TABLE","data":"tag_name\tcount\nparty\t7\npark\t6\noutdoors\t6\nadventure\t6\nbeach\t6\ncamping\t6\nfood\t5\nhike\t5\nhiking\t5\nfitness\t4\narts\t3\nanimals\t3\ntropical\t3\ngirl\t2\nsolo\t2\ncruise\t2\nroad\t2\ndiving\t2\nfashion\t2\nmusic\t2\noutdoor\t2\nboy\t1\nroad trip\t1\nkid-friendly\t1\nphotography\t1\nboating\t1\ncity\t1\nocean\t1\n"}]},"apps":[],"jobName":"paragraph_1570752032183_705493932","id":"20191011-000032_715807548","dateCreated":"2019-10-11T00:00:32+0000","dateStarted":"2019-10-11T00:30:56+0000","dateFinished":"2019-10-11T00:31:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69737","title":"TOP INTERESTS (BY POSTS)","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-d290-m.us-central1-a.c.shared-world.internal:4040/jobs/job?id=4"],"interpreterSettingId":"spark"}},"focus":true},{"title":"TOP INTERESTS (BY USERS)","text":"//Create df of tags for all posts\nval tagged_users = spark.read.jdbc(jdbcUrl, \"taggit_taggeditem\", connectionProperties).filter($\"content_type_id\" === 10).select($\"object_id\", $\"tag_id\").toDF(\"user_id\", \"tag_id\")\n\n// Create df of tag names\nval tags = spark.read.jdbc(jdbcUrl, \"taggit_tag\", connectionProperties).select($\"id\",$\"name\").toDF(\"tag_id\", \"tag_name\").join(tagged_users, \"tag_id\").groupBy(\"tag_name\").count().sort($\"count\".desc)\n\nz.show(tags)","user":"anonymous","dateUpdated":"2019-10-11T00:33:34+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"1":{"graph":{"mode":"stackedAreaChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"tag_name":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"tag_name","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionSupport":true,"completionKey":"TAB"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tagged_users: org.apache.spark.sql.DataFrame = [user_id: int, tag_id: int]\ntags: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [tag_name: string, count: bigint]\n"},{"type":"TABLE","data":"tag_name\tcount\noutdoors\t6\nbeach\t3\nhiking\t3\nboy\t2\nsolo\t2\nadventure\t2\ngirl\t2\nparty\t2\nfitness\t2\nfashion\t2\nanimals\t2\ncamping\t1\npark\t1\nski\t1\nhike\t1\nfood\t1\nmusic\t1\nbudget\t1\narts\t1\nfamily\t1\ntropical\t1\nelder\t1\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-d290-m.us-central1-a.c.shared-world.internal:4040/jobs/job?id=1"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1570751693599_-1403823757","id":"20191010-235453_1315463337","dateCreated":"2019-10-10T23:54:53+0000","dateStarted":"2019-10-11T00:26:33+0000","dateFinished":"2019-10-11T00:26:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69734"},{"title":"TOP INTERESTS (FOR CHOSEN COUNTRY)","text":"// Choose the country to view:\nval country = \"AU\"\n\n\n//Create df of tags for all posts\nval tagged_posts = spark.read.jdbc(jdbcUrl, \"taggit_taggeditem\", connectionProperties).filter($\"content_type_id\" === 9).select($\"object_id\", $\"tag_id\").toDF(\"post_id\", \"tag_id\")\n\n// Create df of tag names\nval tags = spark.read.jdbc(jdbcUrl, \"taggit_tag\", connectionProperties).select($\"id\",$\"name\").toDF(\"tag_id\", \"tag_name\").join(tagged_posts, \"tag_id\")\n\n// Create df of posts with countryid and tag_id and tag name\nval posts = spark.read.jdbc(jdbcUrl, \"post_post\", connectionProperties).select($\"id\",$\"country_id\").toDF(\"post_id\", \"country_id\").join(tags, \"post_id\")\n\n//Iterate over each country\nval country_posts = posts.filter($\"country_id\" === country).groupBy(\"tag_name\").count().sort($\"count\".desc)\nz.show(country_posts)","user":"anonymous","dateUpdated":"2019-10-11T00:26:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"1":{"graph":{"mode":"pieChart","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"country: String = AU\ntagged_posts: org.apache.spark.sql.DataFrame = [post_id: int, tag_id: int]\ntags: org.apache.spark.sql.DataFrame = [tag_id: int, tag_name: string ... 1 more field]\nposts: org.apache.spark.sql.DataFrame = [post_id: int, country_id: string ... 2 more fields]\ncountry_posts: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [tag_name: string, count: bigint]\n"},{"type":"TABLE","data":"tag_name\tcount\nhiking\t5\ncamping\t4\nadventure\t3\noutdoors\t3\nanimals\t2\nroad\t2\ngirl\t2\nsolo\t2\nparty\t2\nfashion\t2\nbeach\t1\nboy\t1\ncity\t1\ndiving\t1\noutdoor\t1\nocean\t1\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-d290-m.us-central1-a.c.shared-world.internal:4040/jobs/job?id=2"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1570751947464_393885105","id":"20191010-235907_1871918639","dateCreated":"2019-10-10T23:59:07+0000","dateStarted":"2019-10-11T00:26:43+0000","dateFinished":"2019-10-11T00:26:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69735"}],"name":"shared-world-data","id":"2ESGTRYX2","noteParams":{},"noteForms":{},"angularObjects":{"jdbc:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}